.PHONY: build run test clean dev tidy fmt lint help

# å˜é‡
BINARY_NAME=claude-relay-go
BUILD_DIR=./bin
MAIN_PATH=./cmd/relay

# æ„å»º
build:
	@echo "ğŸ”¨ Building..."
	@mkdir -p $(BUILD_DIR)
	@go build -o $(BUILD_DIR)/$(BINARY_NAME) $(MAIN_PATH)
	@echo "âœ… Build complete: $(BUILD_DIR)/$(BINARY_NAME)"

# å¼€å‘æ¨¡å¼è¿è¡Œ
dev:
	@echo "ğŸš€ Running in development mode..."
	@GO_PORT=8080 go run $(MAIN_PATH)/main.go

# ç”Ÿäº§è¿è¡Œ
run: build
	@echo "ğŸš€ Running..."
	@$(BUILD_DIR)/$(BINARY_NAME)

# æµ‹è¯•
test:
	@echo "ğŸ§ª Running tests..."
	@go test -v ./...

# æ¸…ç†
clean:
	@echo "ğŸ§¹ Cleaning..."
	@rm -rf $(BUILD_DIR)
	@go clean

# ä¾èµ–æ•´ç†
tidy:
	@echo "ğŸ“¦ Tidying dependencies..."
	@go mod tidy

# æ ¼å¼åŒ–
fmt:
	@echo "ğŸ¨ Formatting code..."
	@go fmt ./...

# ä»£ç æ£€æŸ¥
lint:
	@echo "ğŸ” Linting..."
	@golangci-lint run || echo "golangci-lint not installed, skipping..."

# å®‰è£…ä¾èµ–
deps:
	@echo "ğŸ“¦ Installing dependencies..."
	@go mod download

# å¸®åŠ©
help:
	@echo "Available commands:"
	@echo "  make build  - Build the binary"
	@echo "  make dev    - Run in development mode"
	@echo "  make run    - Build and run"
	@echo "  make test   - Run tests"
	@echo "  make clean  - Clean build artifacts"
	@echo "  make tidy   - Tidy go modules"
	@echo "  make fmt    - Format code"
	@echo "  make lint   - Run linter"
	@echo "  make deps   - Download dependencies"
